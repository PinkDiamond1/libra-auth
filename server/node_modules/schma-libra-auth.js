/*
mkdir -p /db/mongodb/libra-auth-addr
mkdir -p /db/log/libra-auth-addr/
old $ mongod --journal --smallfiles --port 27020 --dbpath /db/mongodb/libra-auth-addr --fork --logpath /db/log/libra-auth-addr/mongodb.log --logappend

mongod --journal --smallfiles --port 27020 --config /etc/mongod.conf --dbpath /db/mongodb/libra-auth-addr --fork --logpath /db/log/libra-auth-addr/mongodb.log --logRotate rename --auth

cat /etc/mongod.conf

# Listen to local interface only. Comment out to listen on all interfaces.
bind_ip=127.0.0.1,192.168.1.36

#ssl:
#    mode: requireSSL
#    PEMKeyFile: /etc/ssl/mongodb.pem


npm install mongoose
+ mongoose@5.11.7

mongod --journal --smallfiles --port 27020 --config /etc/mongod.conf --dbpath /db/mongodb/libra-auth-addr --fork --logpath /db/log/libra-auth-addr/mongodb.log --logRotate rename

mongo localhost:27020

実行用ユーザーを作る
> use libra-auth-addr
switched to db libra-auth-addr

>db.createUser({
     user: "libra-auth-addr",
     pwd: "mari0604",
     roles: [{
        role: "readWrite", db: "libra-auth-addr"
    }]
 })
Successfully added user: {
        "user" : "libra-auth-addr",
        "roles" : [
                {
                        "role" : "readWrite",
                        "db" : "libra-auth-addr"
                }
        ]
}

>exit

$ ps ax | grep 27020
23958 ?        SLl    0:03 mongod --journal --smallfiles --port 27020 --config /etc/mongod.conf --dbpath /db/mongodb/libra-auth-addr --fork --logpath /db/log/libra-auth-addr/mongodb.log --logRotate rename
sudo kill -9 23958

authをつけてmongodを再起動
mongod --journal --smallfiles --port 27020 --config /etc/mongod.conf --dbpath /db/mongodb/libra-auth-addr --fork --logpath /db/log/libra-auth-addr/mongodb.log --logRotate rename --auth

crontab -e 
@reboot mongod --journal --smallfiles --port 27020 --config /etc/mongod.conf --dbpath /db/mongodb/libra-auth-addr --fork --logpath /db/log/libra-auth-addr/mongodb.log --logRotate rename --auth

compass
mongodb://libra-auth-addr:mari0604@192.168.1.36:27020/schma-libra-auth?authSource=libra-auth-addr&readPreference=primary&appname=MongoDB%20Compass&ssl=false


// これ必要かな MongoDB3.4をインストール後のウォーニングを消す
https://code-macchiato.com/tips/ubuntu-remove-mongodb-warning
*/
const mongoose = require('mongoose');
const tanshindb = mongoose.createConnection('mongodb://libra-auth-addr:mari0604@localhost:27020/libra-auth-addr', { 
    useNewUrlParser: true,
    useUnifiedTopology: true
});
mongoose.set('useFindAndModify', false);
mongoose.set('useCreateIndex', true);

 /*
const db = mongoose.createConnection('mongodb://reien-pdf2db:mari0604@localhost:27054/reien-pdf2db', { 
    useNewUrlParser: true,
    useUnifiedTopology: true
});
 */

//---------------------------------------------------------
// libra-auth
// 
let libraauthSchema = {
   utime:  {type: Number, required: true}
  ,addr :  {type: String, required: true}
  ,pubkey: {type: String, required: true}
  ,sigB :  {type: String, required: true}
}
// スキーマ定義
let schemaLibraauth = new mongoose.Schema(libraauthSchema);
// モデル定義
let modelLibraAuth = tanshindb.model('libra-auth', schemaLibraauth);


//---------------------------------------------------------
// 操作用オブジェクト
let schema = new function() {
    this.modelLibraAuth = modelLibraAuth;
};

// モジュール化
module.exports = schema;